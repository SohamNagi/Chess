void Xwindow::drawString(int x, int y, string msg) {
  char **missing_charset_list_return;
  int missing_charset_count_return;
  char *def_string_return;
  std::string fontname = "-*-*-demibold-r-*-*-34-240-100-100-*-203-*-*";
  XFontSet set = XCreateFontSet(d, fontname.c_str(), &missing_charset_list_return, &missing_charset_count_return, &def_string_return);
  Xutf8DrawString(d,w,set,DefaultGC(d, s), x, y, msg.c_str(), msg.length());
  XFreeFontSet(d, set);
}


////// GFX

#include "graphicObserver.h"
#include "window.h"
#include "game.h"

// Constructs Board and Window
graphicObserver::graphicObserver(Game* sub):
    win{new Xwindow(500,500)}, subject{sub}
{
    std::string header = "CS246 - C++ Chess";
    win->drawString(90, 35, header);
    grid.assign(64, ' ');
    int shift = 50;
    char file = 'A';
    for(int i = 0; i < 8; i++){
        win->drawString(20, i*50 + 35 + shift, std::to_string(8-i));
        for(int j = 0; j < 8; j++){
            if ((j+i) % 2 != 0){
                win->fillRectangle((i*50) + shift, (j*50) + shift, 50, 50, 4); // Print Black Square
            }
        }
        std::string s(1,file);
        win->drawString((i*50) + 10 + shift, 490, s);
        file++;
    }
    win->fillRectangle(shift, shift, 400, 5, 1);
    win->fillRectangle(shift, shift, 5, 400, 1);
    win->fillRectangle(400+shift, shift, 5, 405, 1);
    win->fillRectangle(shift, 400+shift, 400, 5, 1);
};

graphicObserver::~graphicObserver(){
    delete win;
}

void graphicObserver::notify(){
    int shift = 50;
    for(int i = 0; i < 8; i++){
        for(int j = 0; j < 8; j++){
            int index = (8*(7-j)) + (i); // Printing direction is not same as board so we offset
            char curr = subject->getState(index); // Fetch Current Char
            if(curr != grid[index]){ // Optimization - Store board and only print if changed
                if ((j+i) % 2 != 0){
                    win->fillRectangle((i*50) + shift, (j*50) + shift, 50, 50, 4); // Print Black Square
                } else {
                    win->fillRectangle((i*50) + shift, (j*50) + shift, 50, 50, 0);
                }
                grid[index] = curr; // Reset Value in Optimization index
                std::string s(1, curr);
                win->drawString(i*50 + 15 + shift, j*50 + 35 + shift, s); // Print Piece Name
            }
        }
    }
    // Print Board Borders
    win->fillRectangle(shift, shift, 400, 5, 1);
    win->fillRectangle(shift, shift, 5, 400, 1);
    win->fillRectangle(400+shift, shift, 5, 405, 1);
    win->fillRectangle(shift, 400+shift, 400, 5, 1);
}
            
                
                